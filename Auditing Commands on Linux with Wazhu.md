Wazuh utilises the auditd package that can be installed on Wazuh agents running on Debian/Ubuntu and CentOS operating systems. In this task, we will be using auditd on a Ubuntu system. Auditd monitors the system for certain actions and events and will write this to a log file.

We can then use the log collector module on a Wazuh agent to read this log file and send it to the Wazuh management server for processing.

First, we will need to install the auditd package and an auditd plugin. This may already be installed on your system; however, let’s install it to make sure. Let’s run the command sudo apt-get install auditd audispd-plugins and enable this service to run currently as well as on boot.sudo systemctl enable auditd.service & sudo systemctl start auditd.service

We will need to configure auditd to create a rule for the commands and events that we wish for it to monitor. In this task, we will be telling auditd to monitor for any commands executed as root.

You can extend this to monitor commands such as tcpdump, netcat, or catting files such as /etc/passwd, which are all hallmarks of a breach.

Auditd rules are located in the following directory: /etc/audit/rules.d/audit.rules. We will be adding our rules manually.

For this task, we will need to open this audit.rules file and append our rule ourselves. First, let’s edit the file using sudo nano /etc/audit/rules.d/audit.rules and appending -a exit,always -F arch=64 -F euid=0 -S execve -k audit-wazuh-c

![image](https://github.com/user-attachments/assets/0e7ed13f-5162-4d32-a7aa-3a06c89cb508)

We will now need to inform audits of this new rule, so let's run this command sudo auditctl -R /etc/audit/rules.d/audit.rules to now read the new audit.rules file that we appended to in the previous task.

Now, let’s configure the system that is running a Wazuh agent that we wish to monitor these events on. We’ll be monitoring a Linux host in this case, so like in our previous tasks, we will need to configure the Wazuh agent to detect this new log file that is generated by auditd like so sudo nano /var/ossec/etc/ossec.conf and add the auditd log like so:

![image](https://github.com/user-attachments/assets/13d5e8df-f499-4a6d-98f4-96e6fa030644)


